<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
<title>School Meet Manager — iPad (Offline)</title>
<meta name="apple-mobile-web-app-capable" content="yes"/>
<meta name="apple-mobile-web-app-status-bar-style" content="default"/>
<link rel="manifest" href="data:application/manifest+json,{&quot;name&quot;:&quot;School Meet Manager&quot;,&quot;short_name&quot;:&quot;Meet Manager&quot;,&quot;start_url&quot;:&quot;.&quot;,&quot;display&quot;:&quot;standalone&quot;,&quot;background_color&quot;:&quot;%23111111&quot;,&quot;theme_color&quot;:&quot;%23111111&quot;,&quot;icons&quot;:[{&quot;src&quot;:&quot;icon-192.png&quot;,&quot;sizes&quot;:&quot;192x192&quot;,&quot;type&quot;:&quot;image/png&quot;},{&quot;src&quot;:&quot;icon-512.png&quot;,&quot;sizes&quot;:&quot;512x512&quot;,&quot;type&quot;:&quot;image/png&quot;}]}"/>
<style>
:root { --pad: 14px; --bg: #f7f7fb; --card: #fff; --muted:#6b7280; --b:#e5e7eb; }
*{ box-sizing: border-box; }
body{ margin:0; font:16px system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial; background:var(--bg); color:#111;}
header{ padding:var(--pad); background:#111; color:#fff; }
header h1{ margin:0 0 4px; font-size:20px; }
header .sub{ color:#cbd5e1; font-size:13px; }
nav.tabs{ display:flex; gap:6px; padding:6px var(--pad); background:#fff; border-bottom:1px solid var(--b);}
nav.tabs button{ flex:1; padding:12px; border:1px solid var(--b); background:#fff; border-radius:8px; font-weight:600;}
nav.tabs button.active{ background:#111; color:#fff; }
section.tab{ display:none; padding:var(--pad); }
section.tab.active{ display:block; }
h2{ margin:0 0 10px; font-size:18px; }
h3{ margin:16px 0 8px; font-size:16px; }
.row{ display:flex; flex-wrap:wrap; gap:10px; align-items:center; margin-top:8px;}
.grid{ display:grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap:10px; align-items:end; }
label{ display:flex; flex-direction:column; gap:6px; font-size:14px;}
input, select, textarea, button{ font:inherit; }
input, select, textarea{ padding:10px; border:1px solid var(--b); border-radius:8px; background:#fff; }
textarea{ width:100%; }
button{ padding:12px 14px; border:1px solid var(--b); border-radius:10px; background:#111; color:#fff; }
button.secondary{ background:#fff; color:#111; }
button:active{ transform:scale(0.99); }
.hint{ color:var(--muted); font-size:13px; }
.badge{ margin-left:6px; font-size:11px; background:#eef2ff; color:#3730a3; padding:2px 6px; border-radius:999px; border:1px solid #c7d2fe; }
.small{ font-size:12px; color:#6b7280; }
</style>
</head>
<body>
<header>
  <h1>School Meet Manager</h1>
  <div class="sub">iPad (offline) • 10-7-5-3-2-1 scoring • lane-free</div>
</header>

<div id="storageAlert" style="display:none;padding:10px;background:#fee2e2;color:#991b1b">
  Storage is unavailable (Private Browsing or blocked). Turn off Private Browsing and reload.
</div>
<div id="importMsg" style="display:none;margin:10px 14px;padding:10px;border-radius:8px;background:#fef3c7;color:#92400e;white-space:pre-line"></div>

<nav class="tabs">
  <button data-tab="data" class="active">Data</button>
  <button data-tab="events">Events</button>
  <button data-tab="results">Results</button>
  <button data-tab="reports">Reports</button>
  <button data-tab="settings">Settings</button>
</nav>

<section id="tab-settings" class="tab">
  <h2>Settings</h2>
  <div class="grid">
    <label><input type="checkbox" id="chkPreviewApply" checked/> Preview changes first</label>
    <label><input type="checkbox" id="chkApplyAfterImport" checked/> After import: auto-apply defaults</label>
    <button id="btnUndoApply" class="secondary">Undo last apply</button>
  </div>
  <h3>Import/Export age defaults</h3>
  <button id="btnExportAgeDefaults">Export defaults CSV</button>
  <input id="ageDefCsvFile" type="file" accept=".csv,text/csv" hidden/>
  <button id="btnImportAgeDefaults">Import defaults CSV</button>
</section>

<footer>
  <span>Offline ready • Data stored on this device</span>
</footer>

<script>
/* === Undo snapshot === */
let lastApplySnapshot=null;

async function snapshotEvents(){
  const tx = indexedDB.open("meet-db",1);
  tx.onsuccess = () => {
    const db=tx.result;
    const store=db.transaction("events").objectStore("events");
    const req=store.getAll();
    req.onsuccess=()=>{ lastApplySnapshot=req.result.map(e=>({...e})); };
  };
}

async function undoLastApply(){
  if(!lastApplySnapshot){ alert('No previous apply to undo.'); return; }
  const tx = indexedDB.open("meet-db",1);
  tx.onsuccess=()=>{
    const db=tx.result;
    const store=db.transaction("events","readwrite").objectStore("events");
    lastApplySnapshot.forEach(ev=>store.put(ev));
  };
  lastApplySnapshot=null;
  alert('Undo complete: events restored to previous state.');
}

/* Hook UI */
document.getElementById("btnUndoApply").addEventListener("click",undoLastApply);
document.getElementById("btnImportAgeDefaults").addEventListener("click",()=>document.getElementById("ageDefCsvFile").click());
document.getElementById("btnExportAgeDefaults").addEventListener("click",()=>alert("Export coming soon (CSV template below)."));

/* CSV template for reference */
console.log("Age defaults CSV template:\\n"+
"Age,Type,MinTimeS,MaxTimeS,MinDistM,MaxDistM\\n"+
"U12,track,8,120,,\\n"+
"U12,field,,,1.5,8.0\\n"+
"U13,track,9,150,,\\n"+
"U13,field,,,2.0,12.0");
</script>
</body>
</html>
